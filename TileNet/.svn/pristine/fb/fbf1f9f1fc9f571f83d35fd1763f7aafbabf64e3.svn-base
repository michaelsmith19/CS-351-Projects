package com.putable.tilenet.Util;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import com.putable.tilenet.Client.Agent;
import com.putable.tilenet.Server.ServerModel;
import com.putable.tilenet.factory.MatrixBuilder;
import com.putable.tilenet.factory.MatrixElementBuilder;
import com.putable.tilenet.factory.TileNetMatrixBuilder;
import com.putable.tilenet.factory.OBSOLETE_BUT_I_WILL_USE_THE_FIELDS_LATER;
import com.putable.tilenet.factory.TileNetMatrixElementBuilder;
import com.putable.tilenet.matrix.HomeMatrix;
import com.putable.tilenet.matrix.Matrix;
import com.putable.tilenet.matrix.MatrixElementFactory;
import com.putable.tilenet.matrix.MatrixElementFactory.ElemType;

public class Driver {
	//((c4.1.1.3)) A port can have the range 44456-44459
	private static final int PORT = 44457;
	private static final int MAX_CONNECTIONS = 5;
	
	public static void main(String[] args) throws Exception{
		
		
		//How we can make a home matrix
		MatrixBuilder makeMatrices = new TileNetMatrixBuilder();		
		com.putable.tilenet.factory.Matrix home = makeMatrices.orderMatrix("HOME");
		
		//How we can make an agent
		MatrixElementBuilder makeElements = new TileNetMatrixElementBuilder();
		com.putable.tilenet.factory.MatrixElement jones2 = makeElements.orderElement("AGENT");
		/*
		 * So we can now do this
		 * servEx.submit((com.putable.tilenet.factory.Agent)jones2);
		 */
		
		
		//Start server
		ServerModel serverModel = new ServerModel(PORT, MAX_CONNECTIONS);
		ExecutorService servEx = Executors.newSingleThreadExecutor();
		servEx.submit(serverModel);		
		
		//Make an agent for us to see and use
		ExecutorService clientEx = Executors.newSingleThreadExecutor();
		Agent jones = (Agent) MatrixElementFactory.produce(ElemType.AGENT, "JONES", String.valueOf(PORT));
		clientEx.submit(jones);
		Matrix m = new HomeMatrix();
		jones.show(m);
		
		//Shuts down when our singular agent is finished (JFrames that are open still count!)
		clientEx.shutdown();
		while(!clientEx.isTerminated()) { }
		servEx.shutdown();
	}
}
