package com.putable.tilenet.Util;

import java.awt.Dimension;
import java.awt.GridLayout;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javax.swing.JFrame;

import com.putable.tilenet.blueprints.Element.ElemType;
import com.putable.tilenet.blueprints.ElementBuilder;
import com.putable.tilenet.blueprints.Grid.GridType;
import com.putable.tilenet.blueprints.GridBuilder;
import com.putable.tilenet.blueprints.TileNetElementBuilder;
import com.putable.tilenet.blueprints.TileNetGridBuilder;
import com.putable.tilenet.grid.HomeGrid;
import com.putable.tilenet.matrixelement.Matrix;
import com.putable.tilenet.server.ServerModel;

public class Driver {
	//((c4.1.1.3)) A port can have the range 44456-44459
	private static final int PORT = 44457;
	private static final int MAX_CONNECTIONS = 5;
	
	public static void main(String[] args) throws Exception{
		
		
		//How we can make a home matrix
		GridBuilder makeMatrices = new TileNetGridBuilder();		
		HomeGrid home = (HomeGrid) makeMatrices.orderGrid(GridType.HOME);
		
		//How we can make an agent
		ElementBuilder makeElements = new TileNetElementBuilder();
		Matrix homeMatrix = (Matrix) makeElements.orderElement(ElemType.MATRIX);
		
		home.associate(homeMatrix);		
		
		JFrame frame = new JFrame();
		frame.setPreferredSize(new Dimension(600,600));
		frame.setLayout(new GridLayout());
		frame.add(home.toJPanel(500, 500));
		frame.pack();
		frame.setAlwaysOnTop(true);
		frame.setVisible(true);
		
		
		
		
		
		//Start server
		ServerModel serverModel = new ServerModel(PORT, MAX_CONNECTIONS);
		ExecutorService servEx = Executors.newSingleThreadExecutor();
		servEx.submit(serverModel);		
		
		//Make an agent for us to see and use
		ExecutorService clientEx = Executors.newSingleThreadExecutor();		
		
		
		//Shuts down when our singular agent is finished (JFrames that are open still count!)
		clientEx.shutdown();
		while(!clientEx.isTerminated()) { }
		servEx.shutdown();
	}
}
